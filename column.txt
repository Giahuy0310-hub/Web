-- Sử dụng cơ sở dữ liệu "project"
USE project129;


CREATE TABLE login (
    id INT AUTO_INCREMENT PRIMARY KEY,
    fullname VARCHAR(255),
    phone_number VARCHAR(20),
    email VARCHAR(255),
    password VARCHAR(255)
);

CREATE TABLE product_id (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_product CHAR(15) UNIQUE

);

CREATE TABLE color (
    id_color INT AUTO_INCREMENT PRIMARY KEY,
    tenmau VARCHAR(255),
    hex_color VARCHAR(7)
);

CREATE TABLE categories (
    id_dm INT AUTO_INCREMENT PRIMARY KEY,
    TenDanhMuc VARCHAR(255) UNIQUE
);

CREATE TABLE products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_product CHAR(15),
    id_color INT,
    id_dm INT,
    ten_san_pham VARCHAR(255),
    link_hinh_anh TEXT,
    loaisanpham CHAR(20),
    gia INT,
    img1 TEXT,
    img2 TEXT,
    img3 TEXT,
    img4 TEXT,
    rating DECIMAL(3, 2),
    so_danh_gia INT,
    so_luong_da_ban INT,
    size_S INT,
    size_M INT,
    size_L INT,
    size_XL INT,
    FOREIGN KEY (id_color) REFERENCES color(id_color),
    FOREIGN KEY (id_dm) REFERENCES categories(id_dm),
    FOREIGN KEY (id_product) REFERENCES product_id(id_product)
);

CREATE TABLE DonHang (
    id INT AUTO_INCREMENT PRIMARY KEY,
    hoten VARCHAR(255),
    sodienthoai VARCHAR(15),
    email VARCHAR(255),
    sonha_duong VARCHAR(255),
    phuong_xa VARCHAR(100),
    quan_huyen VARCHAR(100),
    tinh_thanh VARCHAR(100),
    ghichu TEXT,
    totalPrice FLOAT,
    date TIMESTAMP
);

CREATE TABLE chitietdonhang (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_donhang INT,
    ten_san_pham TEXT,
    id_product CHAR(15),
    id_color INT,
    gia INT,
    size CHAR(10),
    quantity INT,
    link_hinh_anh TEXT,
    FOREIGN KEY (id_color) REFERENCES color(id_color),
    FOREIGN KEY (id_product) REFERENCES product_id(id_product),
    FOREIGN KEY (id_donhang) REFERENCES DonHang(id)
);

CREATE TABLE giohang (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nguoidung_id INT,
    id_product CHAR(15),
    ten_san_pham TEXT,
    id_color INT,
    size CHAR(10),
    gia DECIMAL(10, 2),
    quantity INT,
    link_hinh_anh TEXT,
    FOREIGN KEY (id_product) REFERENCES product_id(id_product),
    FOREIGN KEY (nguoidung_id) REFERENCES login(id),
    FOREIGN KEY (id_color) REFERENCES color(id_color)
);


CREATE TABLE product_color (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_product char(15),
    id_color INT,
    FOREIGN KEY (id_product) REFERENCES product_id(id_product),
    FOREIGN KEY (id_color) REFERENCES color(id_color)
);

CREATE TABLE `province` (
  `province_id` int NOT NULL,
  `name` varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Tỉnh thành';

CREATE TABLE `district` (
  `district_id` int NOT NULL,
  `province_id` int NOT NULL,
  `name` varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Quận huyện';

CREATE TABLE `wards` (
  `wards_id` int NOT NULL,
  `district_id` int NOT NULL,
  `name` varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Xã Phường';

ALTER TABLE district ADD FOREIGN KEY (`province_id`) REFERENCES province(`province_id`);
ALTER TABLE wards ADD FOREIGN KEY (`district_id`) REFERENCES district(`district_id`);



https://drive.google.com/file/d/1yXm76S6_ofiDpN0sVNSUcWxauSWDX8hE/view

INSERT into categories (TenDanhMuc) VALUES ('Quần');
INSERT into categories (TenDanhMuc) VALUES ('Áo');
INSERT into categories (TenDanhMuc) VALUES ('Giày');
INSERT into categories (TenDanhMuc) VALUES ('Dép');
INSERT into categories (TenDanhMuc) VALUES ('Thắt lưng');

insert into color (tenmau,hex_color) VALUES ('xanh dương','#99ccff');
insert into color (tenmau,hex_color) VALUES ('hồng','#ff99ff');
insert into color (tenmau,hex_color) VALUES ('cam','#ff9900');
insert into color (tenmau,hex_color) VALUES ('đỏ','#ff0000');

https://getcomposer.org/download/


ALTER TABLE products
ADD COLUMN rating DECIMAL(3, 1) DEFAULT 0.0,
ADD COLUMN so_danh_gia INT DEFAULT 0;


        // Đánh giá
        // function submitReview() {
        //     // Lấy giá trị đánh giá từ số sao đã chọn
        //     var selectedStars = document.querySelectorAll('.star.selected').length;

        //     // Kiểm tra xem đã chọn ít nhất 1 sao chưa
        //     if (selectedStars === 0) {
        //         alert("Vui lòng chọn số sao trước khi gửi đánh giá.");
        //         return;
        //     }

        //     // Gửi đánh giá lên máy chủ và cập nhật dữ liệu đánh giá sản phẩm ở đây (tùy theo cách bạn xử lý)
        //     var xhr = new XMLHttpRequest();
        //     xhr.open('POST', 'product_detail.php', true); // Điều này gửi yêu cầu đánh giá đến cùng trang sản phẩm
        //     xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        //     xhr.onreadystatechange = function() {
        //         if (xhr.readyState === 4 && xhr.status === 200) {
        //             // Xử lý phản hồi từ máy chủ (nếu cần)
        //             console.log(xhr.responseText); // Hiển thị phản hồi từ máy chủ trong console
        //             alert("Đánh giá của bạn đã được gửi thành công.");
        //         }
        //     };
            // xhr.send('product_id=' + <?php echo $product_id; ?> + '&rating=' + selectedStars);
        // }


                // function showReviewForm() {
        //     var reviewForm = document.getElementById('reviewForm');
        //     reviewForm.style.display = 'block';

        //     // Tạo và hiển thị sao đánh giá ở biểu mẫu viết đánh giá
        //     var starRating = document.querySelector('#reviewForm .star-rating');
        //     starRating.innerHTML = ""; // Xóa bất kỳ sao nào đã tồn tại

        //     for (var i = 1; i <= 5; i++) {
        //         var star = document.createElement('span');
        //         star.className = 'star';
        //         star.innerHTML = '&#9733;';
        //         star.onclick = function() {
        //             // Xóa tất cả các lớp 'selected' trên các sao
        //             var stars = document.querySelectorAll('#reviewForm .star');
        //             stars.forEach(function(star) {
        //                 star.classList.remove('selected');
        //             });

        //             // Đặt lớp 'selected' cho các sao được nhấp vào
        //             for (var j = 1; j <= i; j++) {
        //                 stars[j - 1].classList.add('selected');
        //             }
        //         };
        //         starRating.appendChild(star);
        //     }
        // }


         // function closeReviewForm() {
        //     var reviewForm = document.getElementById('reviewForm');
        //     reviewForm.style.display = 'none';

        //     // Xóa tất cả các lớp 'selected' trên các sao trong biểu mẫu viết đánh giá
        //     var stars = document.querySelectorAll('#reviewForm .star');
        //     stars.forEach(function(star) {
        //         star.classList.remove('selected');
        //     });
        // }


            <!-- Biểu mẫu viết đánh giá -->
    <!-- <div id="reviewForm" class="modal" style="display: none;">
        <span class="closeModal" onclick="closeReviewForm()">&times;</span>
        <h3>Viết đánh giá</h3>
        <div class="star-rating"> -->
            <!-- Thêm sao đánh giá ở đây -->
        <!-- </div>
        <button onclick="submitReview()">Gửi đánh giá</button>
    </div> -->